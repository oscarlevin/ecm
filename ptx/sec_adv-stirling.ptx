<?xml version="1.0" encoding="UTF-8"?>
<section xml:id="sec_adv-stirling" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Partitions of Sets</title>

  <introduction>
    <p>
      Partitions are one of the core ideas in discrete mathematics.  Recall that a <term>partition</term> of a set <m>S</m> is a collection of mutually disjoint subsets of <m>S</m> whose union is all of <m>S</m>.  In other words, every element of <m>S</m> belongs to exactly one of the subsets of the partition.  We call the subsets that make up the partition <term>blocks</term> or <term>parts</term> of the partition.
    </p>
    <p>
      The integers can be naturally partitioned into evens and odds.  In fact, this is just a specific case of partitioning the integers by their reminder when divided by a fixed constant; another example is that every integer has remainder 0, 1, or 2 when divided by 3.
    </p>
    <p>
      Finite sets also have natural partitions: the set of all 4-bit strings can be partitioned according to weight: <me>\B^4_0 \cup \B^4_1 \cup \B^4_2 \cup \B^4_3 \cup \B^4_4 = \B^4</me>.
      Using the sum principle on these disjoint sets leads directly to the identity
      <m>\binom{4}{0} + \binom{4}{1} + \binom{4}{2} + \binom{4}{3} + \binom{4}{4} = 2^4</m>
      (and of course the 4 can be replaced with any <m>n</m> here).
    </p>

    <p>
      In fact, many of the identities we established in <xref ref="sec_basic-proofs" /> using a combinatorial proof work precisely because we can count a set of outcomes all at once and also by counting the size of each block in a particular partition.  For example, in <xref ref="act_derangement-binom" /> we proved that
      <me>\binom{n}{0} d_{0} + \binom{n}{1} d_{1} + \binom{n}{2} d_{2} + \ldots + \binom{n}{n} d_{n} = n!</me>
      by partitioning the <m>n!</m> permutations of <m>[n]</m> into blocks according to how many are fixed in position while the rest are deranged.  
    </p>

    <p>
      Even the formula for binomial coefficients, <m>\binom{n}{k} = \frac{n!}{(n-k)!k!}</m>, comes from partitioning the <m>k</m>-permutations of <m>[n]</m> into blocks according to which subset of <m>[n]</m> is selected (and then <m>\binom{n}{k}</m> is precisely the number of blocks).
    </p>

    <p>
      In this section we will abstract this fundamental idea of partitions by one level.  Instead of using particular partitions to answer counting questions, we will ask counting questions about partitions themselves.  As we will see, this helps us solve yet more counting questions. 
    </p>

    <p>
      In <xref ref="sec_basic-quotient"/> we considered some ways to distribute items to recipients.  Most basic counting formulas can be thought of as counting the number of ways to distribute either distinct or identical items to distinct recipients.  For example, distributing <m>k</m> distinct items to <m>n</m> distinct recipients can be done in <m>n^k</m> ways, if recipients can receive any number of items, or <m>P(n,k)</m> ways if recipients can receive at most one item.  If the items are identical, the corresponding number of ways to distribute them are <m>\mchoose{n}{k}</m> and <m>\binom{n}{k}</m>.
    </p>

    <p>
      What if the recipients are not distinct?  Say we wish to distribute <m>k</m> books (either distinct or identical) to <m>n</m> identical boxes.  This is a perfectly natural extension, but we will see the answer is not.  First, let's get a feel for what this might look like for some small values of <m>k</m> and <m>n</m>.
    </p>

    <activity xml:id="act_stirlingintro">
      <introduction>
        <p>
          Suppose you have <m>3</m> distinct books you want to put into <m>5</m> identical boxes.
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            How many ways can you do this if each box can have at most one book?
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            How many ways can you do this if any box can have any number of books?  You might want to consider three cases: one, two, or three boxes are used.  Assume we do not care about the order in which the books are placed inside boxes.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Describe the outcomes we are counting in abstract mathematical terms.  What sort of mathematical objects are we counting?
          </p>
        </statement>
      </task>
    </activity>

    <activity xml:id="act_intpartintro">
      <introduction>
        <p>
          Suppose you have <m>3</m> identical books you want to put in <m>5</m> identical boxes.
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            How many ways can you do this if each box can have at most one book?
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            How many ways can you do this if any box can have any number of books?  Again, you should consider three cases.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            What mathematical objects are we counting here?
          </p>
        </statement>
      </task>
    </activity>
    
    <p>
      Both of the previous two activities can be solved by counting partitions.  The difference comes down to whether we partition a set of distinct objects or identical objects.  It is not immediately clear how to model partitioning identical objects, and we will put this off until <xref ref="sec_adv-linearparts"/>.  Partitioning <em>distinct</em> objects simply means finding a partition of a set, the topic of the current section.
    </p>
    
  </introduction>


  <subsection>
    <title>Stirling Numbers of the Second Kind</title>

    <p>
      We would like to count the number of ways to partition a set.
    </p>

    <definition xml:id="def-stirling">
      <statement>
        <p>
          Denote by <m>S(k,n)</m> the number of partitions of <m>[k]</m> into exactly <m>n</m> subsets.  We call <m>S(k,n)</m> a <term>Stirling number (of the second kind)</term>.
        </p>
      </statement>
    </definition>

    <p>
      Note that we write <m>S(k,n)</m> instead of <m>S(n,k)</m> here because we try to use <m>k</m> for the number of elements being distributed and <m>n</m> for the number of recipients.  When other books use <m>S(n,k)</m>, they mean the number of partitions of <m>[n]</m> into exactly <m>k</m> blocks.  This is the same definition as we give, but with our renamed variables the formulas we get might look different.
    </p>

    <p>
      For example, consider how to partition <m>[3]</m> into exactly two sets:
      <me>
        \{1,2\}, \{3\} \qquad \qquad \{1,3\},\{2\} \qquad \qquad \{2,3\},\{1\}
      </me>
      and that is all, so <m>S(3,2) = 3</m>.  We do not care about the order the elements appear in each block, nor the order in which the blocks appear.  Thus we see the Stirling numbers count the number of ways to distribute <m>k</m> distinct items to <m>n</m> identical recipients so that each recipient gets at least one item.
    </p>

    <activity xml:id="act_stirlingcomputations">
      <introduction>
        <p>
          Get to know the Stirling numbers by finding some.  List the set of partitions and count them.
        </p>
      </introduction>

      <task>
        <statement>
          <p>
            Find <m>S(3,1)</m>, <m>S(4,1)</m> and <m>S(k,1)</m>.
          </p>
        </statement>
      </task>

      <task>
        <statement>
          <p>
            Compute <m>S(2,2)</m>, <m>S(3,2)</m> and <m>S(4,2)</m>.  Find a formula for <m>S(k,2)</m> and prove it is correct.
          </p>
        </statement>
      </task>

      <task>
        <statement>
          <p>
            Compute <m>S(3,3)</m>, and <m>S(4,3)</m>.
          </p>
        </statement>
      </task>

      <task>
        <statement>
          <p>
            Find formulas and give proofs for <m>S(k,k)</m> and
            <m>S(k,k - 1)</m>.
          </p>
        </statement>
        <hint>
          <p>
            What are the possible sizes of parts?
          </p>
        </hint>
        <solution>
          <p>
            If a partition has <m>k-1</m> parts, then one part has two elements, so once we choose those two elements from the <m>k</m> elements, we are done.  Therefore <m>S(k,k-1) = \binom{k}{2}</m>.
          </p>
        </solution>
      </task>
    </activity>



    <p>
      We can arrange the Stirling numbers into a triangle (called <term>Stirling's second triangle</term>).  The first five rows are shown below.  The entries are indexed differently than in Pascal's triangle: the top 1 represents <m>S(1,1)</m>, so for example, <m>S(5,2) = 15</m>.
    </p>

    <sidebyside width="50%">
      <tabular>
        <row>
          <cell></cell>
          <cell></cell>
          <cell></cell>
          <cell></cell>
          <cell>1</cell>
          <cell></cell>
          <cell></cell>
          <cell></cell>
          <cell></cell>
        </row>
        <row>
          <cell/><cell/><cell/>
          <cell>1</cell>
          <cell></cell>
          <cell>1</cell>
          <cell/><cell/><cell/>
        </row>
        <row>
          <cell/><cell/>
          <cell>1</cell>
          <cell></cell>
          <cell>3</cell>
          <cell></cell>
          <cell>1</cell>
          <cell/><cell/>
        </row>
        <row>
          <cell/>
          <cell>1</cell>
          <cell></cell>
          <cell>7</cell>
          <cell></cell>
          <cell>6</cell>
          <cell></cell>
          <cell>1</cell>
          <cell/>
        </row>
        <row>
          <cell>1</cell>
          <cell></cell>
          <cell>15</cell>
          <cell></cell>
          <cell>25</cell>
          <cell></cell>
          <cell>10</cell>
          <cell></cell>
          <cell>1</cell>
        </row>
      </tabular>
    </sidebyside>

    <p>
      How were these found?  Sure, we could have written out all 25 of the partitions of <m>[5]</m> into exactly <m>3</m> blocks, but we didn't.  Could there be some way to get 25 from the entries above it?  That is, what is the recurrence relation among the Stirling numbers?
    </p>

    <activity>
      <!-- <task> -->
        <statement>
          <p>
            Write down (if you haven't already) all 6 partitions of <m>[4]</m> into <m>3</m> blocks.  Break these into two cases by where 4 is: is 4 in solitary confinement (in a singleton set) or does he have a cellmate?
          </p>
        </statement>
      <!-- </task>
      <task> -->
        <!-- <statement>
          <p>
            How could you take the <m>S(4,2) = 7</m> partitions of <m>[4]</m> into 2 sets and the <m>S(4,3) = 6</m> partitions of <m>[4]</m> into 3 sets and form all the <m>S(5,3) = 25</m> partitions of <m>[5]</m> into <m>3</m> sets?
          </p>
        </statement> -->
      <!-- </task> -->
    </activity>

    <p>
      Now that you have some experience with listing the <m>S(4,3)</m> partitions of <m>[4]</m>, the next example will help us to generalize.
    </p>

    <example>
      <statement>
        <p>
          Let's see how to take <m>S(4,2) = 7</m> and <m>S(4,3) = 6</m> to compute <m>S(5,3) = 25</m>.  
        </p>
        
        <p>
          First, here are the partitions of <m>[4]</m> into 2 blocks (group A) or 3 blocks (group B), side by side:
        </p>
        
        <sidebyside widths="50% 30%" valign="top">
          <p>
            Group A: 
            <md>
              <mrow>\{1\}, ~ \{2,3,4\}\qquad \amp \{1,2\}, ~ \{3, 4\}</mrow>
              <mrow>\{2\}, ~ \{1,3,4\}\qquad \amp \{1,3\}, ~ \{2, 4\}</mrow>
              <mrow>\{3\}, ~ \{1,2,4\} \qquad \amp \{2,3\}, ~ \{1, 4\}</mrow>
              <mrow>\{4\}, ~ \{1,2,3\} \qquad\amp </mrow>
            </md>
          </p>
          
          <p>
            Group B: 
            <md>
              <mrow>\{3\}, ~ \{1,2\}, ~ \{4\}</mrow>
              <mrow>\{2\}, ~ \{1,3\}, ~ \{4\}</mrow>
              <mrow>\{2\}, ~ \{1,4\}, ~ \{3\}</mrow>
              <mrow>\{1\}, ~ \{2,3\}, ~ \{4\}</mrow>
              <mrow>\{1\}, ~ \{2,4\}, ~ \{3\}</mrow>
              <mrow>\{1\}, ~ \{3,4\}, ~ \{2\}</mrow>
            </md>
          </p>
        </sidebyside>
        
        <p>
          (Notice the <m>\binom{4}{2}</m> ways of listing the middle column in group B.)
        </p>
        
        <p>
          Now, to list the <m>S(5,3)</m> partitions of <m>[5]</m> into <m>3</m> parts, we need to add 5 somewhere.  We can either
          <ol label="a.">
            <li>
              <p>
                Let 5 be a singleton block, along with any of the partitions from group A; or
              </p>
            </li>
            <li>
              <p>
                Let 5 join any of the blocks in any of the partitions of group B.  
              </p>
            </li>
          </ol>
          The second option can be accomplished in <m>3\cdot 6</m> ways.  Thus <m>S(5,3) = 7 + 3\cdot 6</m>.
        </p>
      </statement>
    </example>

    <activity xml:id="secondstirlingrecurrence" category="essential and interesting">
        <statement>
          <p>
            Now generalize.  In a partition of the set <m>[k]</m>, the number <m>k</m> is either in a block by itself, or it is not.  Find a two variable recurrence for <m>S(k,n)</m>, valid for <m>k</m> and <m>n</m> larger than one.
          </p>
        </statement>
        <hint>
          <p>
            The number of partitions of <m>[k]</m> into <m>n</m> parts in which <m>k</m> is not in a block relates to the number of partitions of <m>k-1</m> into some number of blocks in a way that involves <m>n</m>. With this in mind, review how you proved Pascal's (recurrence) equation.
          </p>
        </hint>

        <solution>
          <p>
            The number of partitions of <m>[k]</m> into <m>n</m> parts in which
            <m>k</m> is in a block with other elements of <m>[k]</m> is equal
            <m>n</m> times the number of partitions of <m>[k-1]</m> into
            <m>n</m> blocks, because <m>k</m> could be in any of the <m>n</m>
            parts, and since it is in a block with other elements of
            <m>[k-1]</m>, removing it leaves a partition of <m>[k-1]</m> into
            <m>n</m> blocks. The number of partitions of <m>[k]</m> into
            <m>n</m> blocks in which <m>k</m> is in a block by itself is the
            number of partitions of <m>[k]</m> into <m>n-1</m> blocks, because
            you can get any such partition by deleting the block containing
            <m>k</m> from a partition of <m>[k]</m> in which <m>k</m> is in a
            block by itself. Thus <m>S(k,n) = S(k-1,n-1) + nS(k-1,n)</m>.
          </p>
        </solution>
    </activity>


    <exploration category="interesting">
      <statement>
        <p>
          Find a recurrence for the Lah numbers <m>L(k,n)</m> similar to the one in <xref ref="secondstirlingrecurrence"/>.
        </p>
      </statement>
      <hint>
        <p>
      To see how many broken permutations of a <m>k</m> element set into <m>n</m> parts do not have <m>k</m> is a part by itself, ask yourself how many broken permutations of <m>[7]</m> result from adding 7 to the one of the two permutations in the broken permutation <m>\{14, 2356\}</m>.
        </p>
      </hint>
      <solution>
        <p>
          <m>L(k,n)</m> is the number of broken permutations of a
          <m>k</m>-element set into <m>n</m> parts. Either <m>k</m> is in an ordered block with other numbers, or it is in a block by itself. If it is with other elements, it can go after any of the <m>k-1</m> other
          elements, or it can go at the beginning of any of the <m>n</m> blocks. If
          it is by itself, deleting it gives a broken permutation of a <m>k-1</m>-element
          set into <m>n-1</m> blocks. Thus <m>L(k,n)=L(k-1,n-1) + (n+k-1)L(k-1,n)</m>.
        </p>
      </solution>
    </exploration>


    <exploration xml:id="sandwiches">
      <statement>
          <p>
            Extend Stirling's triangle enough to allow you to answer the following question and answer it. (Don't fill in the rows all the way; the work becomes quite tedious if you do. Only fill in what you need to answer this question.) A caterer is preparing three bag lunches for hikers. The caterer has nine different sandwiches. In how many ways can these nine sandwiches be distributed into three identical lunch bags so that each bag gets at least one?
          </p>
        </statement>
        <solution>
          <p>
            We need <m>S(9,3)</m>. Thus we need to extend our table for four
            more rows, but only out to the column labeled 3. These rows are,
          </p>
          <sidebyside width="50%">
            <tabular>
              <row>
                <cell right="minor">6</cell>
                <cell>1</cell>
                <cell>31</cell>
                <cell>90</cell>
                <cell><ellipsis /></cell>
              </row>
              <row>
                <cell right="minor">7</cell>
                <cell>1</cell>
                <cell>63</cell>
                <cell>101</cell>
                <cell><ellipsis /></cell>
              </row>
              <row>
                <cell right="minor">8</cell>
                <cell>1</cell>
                <cell>127</cell>
                <cell>966</cell>
                <cell><ellipsis /></cell>
              </row>
              <row>
                <cell right="minor">9</cell>
                <cell>1</cell>
                <cell>255</cell>
                <cell>3025</cell>
                <cell><ellipsis /></cell>
              </row>
            </tabular>
          </sidebyside>
          <p>
            Thus there are 3025 ways to distribute the sandwiches
            into the lunch bags.
          </p>
        </solution>
      </exploration>

      <p>
        We have often thought of counting problems as asking about how many functions there are from a <m>k</m>-elements set to an <m>n</m>-element set.  The answer to this question is <m>n^k</m> for all functions and <m>P(n,k)</m> for injective functions.  What about surjective functions?  There is a reason we haven't asked this question yet, but now we can at least get an expression for the number of surjections in terms of Stirling numbers.
      </p>


    <exploration category="motivation">
      <statement>
        <p>
          Given a function <m>f</m> from a <m>k</m>-element set <m>K</m> to an <m>n</m>-element set, we can define a partition of <m>K</m> by putting <m>x</m> and <m>y</m> in the same block of the partition if and only if <m>f(x)=f(y)</m>. How many blocks does the partition have if <m>f</m> is surjective? How is the number of functions from a <m>k</m>-element set <em>onto</em> an <m>n</m>-element set related to a Stirling number? Be as precise in your answer as you can.<idx><h>function</h><h>surjective!and Stirling Numbers</h></idx><idx><h>surjective function</h><h>counting</h></idx>
        </p>
      </statement>
      <hint>
        <p>
      You can think of a function as assigning values to the blocks of its
      partition. If you permute the values assigned to the blocks, do you always
      change the function?
        </p>
      </hint>
      <solution>
        <p>
          If <m>f</m> is onto, the number of blocks of the partition is <m>n</m>. The number of onto functions from a <m>k</m>-element set onto an <m>n</m>-element set is <m>S(k,n)n!</m>, because we have a one-to-one function from the blocks to the <m>n</m>-element set.
        </p>
      </solution>
    </exploration>

    <p>
      We do not have an explicit formula for either the number of surjections or for <m>S(k,n)</m> yet, but note that if we could find either, we would now have both.  We will see one approach to this soon.
    </p>



        <exploration xml:id="Stirlingfalling" category="essential">
          <statement>
            <p>
              Each function from a <m>k</m>-element set <m>K</m> to an <m>n</m>-element set <m>N</m> is a function from <m>K</m> onto <em>some</em> subset of <m>N</m>. If <m>J</m> is a subset of <m>N</m> of size <m>j</m>, you know how to compute the number of functions that map onto <m>J</m> in terms of Stirling numbers. Suppose you add the number of functions mapping onto <m>J</m> over all possible subsets <m>J</m> of <m>N</m>. What simple value should this sum equal? Write the equation this gives you.
            </p>
          </statement>
          <hint>
            <p>
          When you add the number of functions mapping onto <m>J</m> over all possible subsets <m>J</m> of <m>N</m>, what is the set of functions whose size you are computing?
            </p>
          </hint>
          <solution>
            <p>
              The sum should equal the number of functions, <m>n^k</m>. Thus
              we get <m>\sum_{j=0}^n \binom{n}{j}S(k,j)j! = n^k</m>. By using the fact
              that <m>\binom{n}{j}= P(n,j)/j!</m>, this may be rewritten as
              <m>\sum_{j=0}^n P(n,j)S(k,j) = n^k.</m>
            </p>
          </solution>
        </exploration>

        <exploration category="motivation">
          <statement>
            <p>
              In how many ways can the sandwiches of <xref ref="sandwiches"/> be placed into three distinct bags so that each bag gets at least one?
            </p>
          </statement>
          <solution>
            <p>
              <m>S(9,3)\cdot3!= 55,980</m>.
            </p>
          </solution>
        </exploration>



    <p>
      We will further investigate Stirling numbers in the rest of this section, but first, notice that we have not looked at the number of ways to partition a set into <em>any</em> number of blocks.
    </p>

    <definition xml:id="def-bell">
      <idx><h>Bell Number</h></idx><idx><h>partitions of a set</h><h>number of</h></idx>
      <statement>
        <p>
          The total number of partitions of a <m>k</m>-element set is denoted by <m>B_k</m> and is called the <m>k</m>-th <term>Bell number</term>.
        </p>
      </statement>
    </definition>
    
    <example>
      <p>
        There are five partitions of <m>[3]</m>:
        <md>
          <mrow>\{1\}, \{2\},\{3\}</mrow>
          <mrow>\{1,2\},\{3\} \qquad \{1,3\},\{2\} \qquad \{1\}, \{2,3\}</mrow>
          <mrow>\{1,2,3\}</mrow>.
        </md>
        Note that <m>B_3 = S(3,1)+S(3,2)+S(3,3) = 1 + 3 + 1</m>.
      </p>
    </example>

    <activity xml:id="BellNumberIntro" category="essential for this or the next section">
      <task>
        <statement>
          <p>
            Why is <m>B_k = \sum_{n=1}^{k} S(k,n)</m>, but <m>n^k \ne \sum_{n=1}^k S(k,n)n!</m>?  Why is this a meaningful question?
          </p>
        </statement>
        <hint>
          <p>
            As to why this is a reasonable question, think of distributing <m>k</m> items to <m>n</m> recipients.  All four expressions count the number of ways to do this under different restrictions.
          </p>
        </hint>
      </task>
      <task>
        <statement>
          <p>
            Find a recurrence that expresses <m>B_k</m> in terms of <m>B_n</m> for
            <m>n\lt  k</m> and prove your formula correct in as many ways as you can.
          </p>
        </statement>
        <hint>
          <p>
        Here it is helpful to think about what happens if you delete the entire block containing <m>k</m> rather than thinking about whether <m>k</m> is in a block by itself or not.
          </p>
        </hint>
        <solution>
          <p>
            If we delete the block containing <m>k</m>, we get a partition of
            a subset of <m>[k-1]</m>. Thus <m>B_k</m> is the sum over all subsets of
            <m>[k-1]</m> of the number of partitions of that subset. This gives us
            <m>B_k= \sum_{n=0}^{k-1}\binom{k-1}{n}B_n</m>.
          </p>

          <p>
            Alternatively, we can show by the same sort of argument that
            <m>S(k,n)=\sum_{i=0}^{k-1} \binom{k-1}{i}S(i,n-1)</m> and then use the fact
            that <m>B_k =\sum_{n=0}^k S(k,n)</m> to get the recurrence for <m>B_k</m>.
          </p>
        </solution>
      </task>

      <task>
        <statement>
          <p>
            Find <m>B_k</m> for <m>k=1,2,4,5,6</m>.
          </p>
        </statement>
        <solution>
            <p>
                <me>
                    B_4 =\binom{3}{0}B_0 +\binom{3}{1}B_1 +\binom{3}{2}B_2 +
                    \binom{3}{3}B_3=1 +3+3\cdot2 +5=15
                </me>
                <me>
                    B_5 = \sum_{n=0}^4 \binom{4}{n}B_n = 1 +4+6\cdot2 +4\cdot5 + 15=52
                </me>
                <me>
                    B_6 = \sum_{n=0}^5 \binom{5}{n}B_n =1+5 +10\cdot2 +10\cdot 5
                    +5\cdot 15 +52=203
                </me>
            </p>
        </solution>
      </task>
    </activity>

    <p>
      The Bell numbers are interesting in their own right, and we will look at them more in <xref ref="subsec_bell"/>.
    </p>

  </subsection>


  <subsection xml:id="subsec-stirlingformulas">
    <title>Formulas for Stirling Numbers (of the second kind)</title>

    <p>
      Here is a brief summary of what we have already discovered.
    </p>

    <p>
      Directly from the definition, we see that <m>S(k,1) = 1</m> and <m>S(k,k) = 1</m>.  From these we can compute the remaining Stirling numbers using the recursion
      <me>
        S(k,n) = nS(k-1,n) + S(k-1, n-1).
      </me>
      This recursion is justified by dividing the partitions of <m>[k]</m> into those which contain <m>k</m> as a singleton set (there are <m>S(k-1, n-1)</m> of these) and those that don't (there are <m>n</m> choices for where <m>k</m> could be for each of the <m>S(k-1, n)</m> partitions of <m>[k-1]</m> into <m>n</m> blocks).
    </p>

    <p>
      From this, we generated Stirling's second triangle.
    </p>

    <sidebyside width="50%">
      <tabular>
        <row>
          <cell></cell>
          <cell></cell>
          <cell></cell>
          <cell></cell>
          <cell>1</cell>
          <cell></cell>
          <cell></cell>
          <cell></cell>
          <cell></cell>
        </row>
        <row>
          <cell/><cell/><cell/>
          <cell>1</cell>
          <cell></cell>
          <cell>1</cell>
          <cell/><cell/><cell/>
        </row>
        <row>
          <cell/><cell/>
          <cell>1</cell>
          <cell></cell>
          <cell>3</cell>
          <cell></cell>
          <cell>1</cell>
          <cell/><cell/>
        </row>
        <row>
          <cell/>
          <cell>1</cell>
          <cell></cell>
          <cell>7</cell>
          <cell></cell>
          <cell>6</cell>
          <cell></cell>
          <cell>1</cell>
          <cell/>
        </row>
        <row>
          <cell>1</cell>
          <cell></cell>
          <cell>15</cell>
          <cell></cell>
          <cell>25</cell>
          <cell></cell>
          <cell>10</cell>
          <cell></cell>
          <cell>1</cell>
        </row>
      </tabular>
    </sidebyside>

    <exploration>
      <statement>
        <p>
          Use the recursion to find the 6th row of the triangle.
        </p>
      </statement>
    </exploration>

    <p>
      Let's consider some ways to compute Stirling numbers directly.
    </p>

    <p>
      While we might not have a nice closed formula for all Stirling numbers in terms of <m>k</m> and <m>n</m>, we can give closed formulas for those Stirling numbers close to the edges of the triangle.  We have already considered some of these in <xref ref="act_stirlingcomputations"/>.  To get back into the right mindset, start by reproving one of these.
    </p>

    <exploration>
      <statement>
        <p>
          Prove <m>S(k, k-1) = \binom{k}{2}</m>.
        </p>
      </statement>
      <hint>
        <p>
          What are the possible sizes of parts?
        </p>
      </hint>
      <solution>
        <p>
          If a partition has <m>k-1</m> parts, then one part has two elements, so once we choose those two elements from the <m>k</m> elements, we are done.  Therefore <m>S(k,k-1) = \binom{k}{2}</m>.
        </p>
      </solution>
    </exploration>

    <p>
      The proof of the formula above suggests that looking at the sizes of the blocks might be helpful.  Let's see what this might look like with an example.
    </p>

    <activity>
      <introduction>
        <p>
          How many ways are there to partition <m>[5]</m> into three sets?
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            How many partitions of <m>[5]</m> have two blocks of size 1 and one block of size 3?
          </p>
        </statement>
        <solution>
          <p>
            There will be <m>10 = \binom{5}{3}</m>.  Once you select the three elements to be in the block of size 3, the other two must be in blocks of size 1 each.
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            How many partitions of <m>[5]</m> have one block of size 1 and two of size 2?
          </p>
        </statement>
        <hint>
          <p>
            Careful here.  The answer is NOT <m>\binom{5}{2}\binom{3}{2}</m>.  Do you see why?
          </p>
        </hint>
        <solution>
          <p>
            We can select two elements to be in a block of size 2 in <m>\binom{5}{2}</m> ways.  Then you can select two of the remaining elements for the block of size 2 in <m>\binom{3}{2}</m> ways.  However, just multiplying these two double counts since we do not care about the order in which the blocks appear.  Thus there are <m>\frac{1}{2}\binom{5}{2}\binom{3}{2} = 15</m> partition of <m>[5]</m> of this type.
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            Are there any other types of partitions we need to consider?  What is <m>S(5,3)</m>?
          </p>
        </statement>
        <solution>
          <p>
            Any partition of 5 into 3 blocks must have at least one element in each block; the remaining two elements could be in a block together or two different blocks.  So the two cases above are all the cases.  This tell us <m>S(5,3) = 25</m>.
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            Generalize! Find a formula for <m>S(k, k-2)</m>.
          </p>
        </statement>
        <solution>
          <p>
            <m>S(k, k-2) = \binom{k}{3} + \frac{1}{2}\binom{k}{2}\binom{k-2}{2}</m>.  Because we have two fewer blocks than we have elements, there will always either be a block of size three and <m>k-3</m> blocks of size one or two blocks of size two and <m>k-4</m> blocks of size 1.  The first case accounts for <m>\binom{k}{3}</m> partitions (once you have chosen the three elements to be in the large block, you are done).  The second case accounts for <m>\frac{1}{2}\binom{k}{2}\binom{k-2}{2}</m> partitions (pick 2 elements to be together, then 2 of the remaining to be together, but don't care which order you pick these in).
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            A friend tells you that <m>S(k,k-2) = \binom{k}{3} + 3 \binom{k}{4}</m>.  Prove this is correct also.  If this is the formula you found for the previous part, see the hint.
          </p>
        </statement>
        <hint>
          <p>
            If you found this formula for <m>S(k,k-2)</m> in part (e), then pretend your friend claims that <m>S(k, k-2) = \binom{k}{3} + \frac{1}{2}\binom{k}{2}\binom{k-2}{2}</m> and prove why that is correct too.
          </p>
        </hint>
        <solution>
          <p>
            The <m>\binom{k}{3}</m> still counts the partitions in which one block has size three.  Now we can pick four elements to be in the two blocks of size 2 in <m>\binom{k}{4}</m> ways.  But these four elements can be broken into two equally sized blocks in 3 ways (pick the cell-mate of the first element).  
          </p>
        </solution>
      </task>
    </activity>

    <p>
      <idx><h>partition of a set</h><h>type vector</h></idx><idx><h>type vector of a partition of a set</h></idx>
      Whenever we want to partition <m>k</m> items in <m>n</m> blocks, we can consider cases.  We will represent each type of case with a <term>type vector</term> consisting of a sequence <m>(a_1, a_2, \ldots, a_k)</m> where each <m>a_i</m> is the number of blocks that have size <m>i</m>.  For example, in partitioning <m>[5]</m> into 3 blocks, the previous activity first asked for the number of partitions with type vector <m>(2,0,1,0,0)</m>, two blocks of size 1 and one of size 3, and then for the number of partitions with type vector <m>(1,2,0,0,0)</m>, one block of size 1 and two of size 2.  Note that <m>\sum_{i=1}^k a_i = n</m> and <m>\sum_{i=1}^k ia_i = k</m>.
    </p>

    <activity>
      <task>
        <statement>
          <p>
            How many partitions of <m>[6]</m> are there into 3 blocks?  List all the type vectors and the number of partitions for each.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Generalize to find a formula for <m>S(k,k-3)</m>.  Then clean up the formula so it is a linear combination of <m>\binom{k}{4}</m>, <m>\binom{k}{5}</m>, and <m>\binom{k}{6}</m>.
          </p>
        </statement>
        <hint>
          <p>
            While you might not get this formula by conisdering type vectors, you should be shooting to prove <m>S(k, k-3) = \binom{k}{4} + 10 \binom{k}{5} + 16 \binom{k}{6}</m>
          </p>
        </hint>
      </task>
    </activity>






    <activity xml:id="partitionsgivenpartsize" category="essential">
        <statement>
          <p>
            In how many ways can we partition <m>k</m> items into <m>n</m> blocks so that we have <m>a_i</m> blocks of size <m>i</m> for each <m>i</m>? That is, given the type vector <m>(a_1, a_2, \ldots, a_k)</m>, how many partitions of <m>[k]</m> into <m>n</m> blocks have that type vector.
          </p>
        </statement>
        <hint>
          <p>
            Suppose we make a list of the <m>k</m> items. We take the first <m>a_1</m> elements to be the blocks of size 1. How many elements do we need to take to get <m>a_2</m> blocks of size two? Which elements does it make sense to choose for this purpose?
          </p>
        </hint>
        <solution>
          <p>
            <m>\frac{n!}{\prod_{i=1}^n (i!)^{a_i}{a_i!}}</m>. We can make a list in <m>n!</m> ways, and then break it into first <m>a_1</m> blocks of size 1, then <m>a_2</m> blocks of size 2, <m>a_3</m> blocks of size 3 up to <m>a_n</m> blocks of size <m>n</m>. But then we realize that we get the same partition if we permute the <m>i!</m> elements of a block of size <m>i</m> and we get the same partition if we permute the <m>a_i</m> blocks of size <m>i</m> so we apply the quotient principle.
          </p>
        </solution>
    </activity>


    <activity category="summary">
        <statement>
          <p>
            Describe how to compute <m>S(k,n)</m> in terms of quantities given by the formula you found in <xref ref="partitionsgivenpartsize"/>.
          </p>
        </statement>
        <solution>
          <p>
            We can find <m>S(k,n)</m> by summing <m>\frac{n!}{\prod_{i=1}^n (i!)^{a_i}{a_i!}}</m> over all type vectors <m>(a_1,a_2,\ldots,a_k)</m> such that <m>a_1+a_2+\cdots+a_k=n</m>.
          </p>
        </solution>
    </activity>


    <activity>
      <statement>
        <p>
          Explain why <m>S(k, 2) = 2^{k-1} - 1</m>.  Then find another expression for <m>S(k,2)</m> using type vectors to establish an interesting identity.
        </p>
      </statement>
    </activity>



  <paragraphs xml:id="pars-multinomial">
    <title>Interlude: Multinomial Coefficients</title>


  <p>
    Recall that the Stirling numbers counted the number of ways to distribute 9 distinct sandwiches to three identical sandwich bags.  This suggests a more realistic question.
  </p>

  <activity xml:id="caterer2">
    <statement>
      <p>
        In how many ways may the caterer distribute the nine sandwiches into three identical bags so that each bag gets exactly three? Answer this question.
      </p>
    </statement>
    <hint>
      <p>
        What if the question asked about six sandwiches and two distinct bags? How does having identical bags change the answer?
      </p>
    </hint>
    <solution>
      <p>
        <m>\binom{9}{3}\binom{6}{3}\binom{3}{3}/3!</m>. First we choose
        three sandwiches for bag 1, then three for bag 2, and put the remainder in
        bag 3. However, it doesn't matter which bags the sandwiches
        are in so we have counted each partition <m>3!</m> times.
      </p>
  </solution>
</activity>

    <activity category="motivation">
      <statement>
        <p>
          In how many ways can the sandwiches of <xref ref="caterer2"/> be placed into <em>distinct</em> bags so that each bag gets exactly three?
        </p>
      </statement>
      <solution>
        <p>
          Choose three sandwiches for bag one in <m>\binom{9}{3}</m> ways, three for bag two in <m>\binom{6}{3}</m> ways and put the remainder in bag 3.  This gives us <m>\binom{9}{3}\binom{6}{3}=\frac{9!}{3!3!3!}=1680</m> ways.
        </p>

        <p>
          The <m>\frac{9!}{3!3!3!}</m> suggests another solution. We can line up the
          sandwiches in 9! ways. We take the first three for bag one, the
          second three for bag two and the last three for bag 3. The order of
          the sandwiches in the bag does not matter though, so each there are
          <m>3!3!3!</m> listings corresponding to each way of putting sandwiches in
          bags, giving us <m>\frac{9!}{3!3!3!}</m> ways to put the sandwiches in bags.
        </p>
      </solution>
    </activity>

    <p>
      This is an example of a <term>multinomial coefficient</term>.  Although these are not directly related to Stirling numbers, we can use the ideas of type vectors to investigate them.  Let's do that now.
    </p>

    <!-- TODO: needs examples? -->

    <activity category="essential">
        <statement>
          <p>
            In how many ways may we label the elements of a <m>k</m>-element set with <m>n</m> distinct labels (numbered 1 through <m>n</m>) so that label <m>i</m> is used <m>j_i</m> times?
            (If we think of the labels as <m>y_1, y_2, \ldots, y_n</m>, then we can rephrase this question as follows.  How many functions are there from a <m>k</m>-element set <m>K</m> to a set <m>N=\{y_1,y_2,\ldots y_n\}</m> so that <m>y_i</m> is the image of <m>j_i</m> elements of <m>K</m>?)
            This number is called a <term>multinomial coefficient</term><idx><h>multinomial coefficient</h></idx><idx><h>coefficient</h><h>multinomial</h></idx> and denoted by
            <me>
              \binom{k}{j_1,j_2,\ldots, j_n}.
            </me>
          </p>
        </statement>
        <hint>
          <p>
        What if the <m>j_i</m>'s don't add to <m>k</m>?
          </p>
        </hint>
        <hint>
          <p>
        Think about listing the elements of the <m>k</m>-element set and labeling the first <m>j_1</m> elements with label number 1.
          </p>
        </hint>
        <solution>
          <p>
            If the <m>j_i</m>'s don't add to <m>k</m>, it is zero.  Otherwise <m>\binom{k}{j_1,j_2,\ldots, j_n} =
            \frac{k!}{j_1!j_2!\cdots j_n!}</m>. We get this either as the
            product of binomial coefficients
            <me>
              \binom{k}{j_1}\binom{k-j_1}{j_2}\binom{k-j_1-j_2}{j_3}\cdots\binom{j_n}{j_n},
            </me>
            or more elegantly, by lining up the elements of the domain in <m>k!</m> ways, taking the first <m>j_1</m> elements to <m>y_1</m>, the next <m>j_2</m> elements to <m>y_2</m> and so on.  However the order of the <m>j_i</m> elements that go to <m>y_i</m> is irrelevant, so <m>j_1!j_2!\cdots j_n!</m> lists all correspond to the same function, giving us <m>\frac{k!}{j_1!j_2!,\cdots j_n!}</m> functions.
          </p>
        </solution>
      </activity>


      <activity>
        <statement>
          <p>
            Explain how to compute the number of functions from a <m>k</m>-element set <m>K</m> to an <m>n</m>-element set <m>N</m> by using multinomial coefficients.
          </p>
        </statement>
        <hint>
          <p>
            The sum principle will help here.
          </p>
        </hint>
        <solution>
          <p>
            Add the multinomial coefficients <m>\binom{k}{j_1,j_2,\ldots,j_n}</m> over all possible nonnegative values of the <m>j_i</m>'s that add to <m>k</m>.  To see why, let <m>N=\{y_1,y_2,\ldots,y_n\}</m> and apply the definition of multinomial coefficients.
          </p>
        </solution>
      </activity>




    <activity>
        <statement>
          <p>
            Explain how to compute the number of functions from a <m>k</m>-element set <m>K</m> onto an <m>n</m>-element set <m>N</m> by using multinomial coefficients.
          </p>
        </statement>
        <hint>
          <p>
        How are the relevant <m>j_i</m>'s in the multinomial coefficients you use here different from the <m>j_i</m>'s in the previous problem.
          </p>
        </hint>
        <solution>
          <p>
            Add the multinomial coefficients <m>\binom{k}{j_1,j_2,\ldots,j_n}</m> in which each <m>j_i</m> is different from zero. To see why, let <m>N=\{y_1,y_2,\ldots,y_n\}</m> and note that we are counting functions that send at least one element of <m>K</m> to each element <m>y_i</m>.
          </p>
        </solution>
    </activity>





    <activity category="essential">
      <statement>
        <p>
          What do multinomial coefficients have to do with expanding the
          <m>k</m>th power of a multinomial <m>x_1+x_2+\cdots+x_n</m>? This result is called
          the <term>multinomial theorem</term>.
        </p>
      </statement>
      <hint>
        <p>
          Think about how binomial coefficients relate to expanding a power of a binomial and note that the binomial coefficient <m>\binom{n}{k}</m> and the multinomial coefficient <m>\binom{n}{k,n-k}</m> are the same.
        </p>
      </hint>

      <solution>
        <p>
          When we use the distributive law to multiply out <m>(x_1+x_2+\cdots +x_n)^k</m>, we will get a sum of a bunch of terms of the form <m>x_1^{i_1}x_2^{i_2}\cdots x_n^{i_n}</m> where <m>i_1+i_2+\cdots+ i_n=k</m>.  The terms with a given sequence <m>i_1,i_2,\ldots, i_n</m> of exponents will arise from choosing, as we apply the distributive law over and over again, <m>x_1</m> from <m>i_1</m> of the factors, <m>x_2</m> from <m>i_2</m> of the factors, and so on. Thus the number of terms <m>x_1^{i_1}x_2^{i_2}\cdots x_n^{i_n}</m> will be the number of ways to label <m>i_1</m> of the factors with a 1, <m>i_2</m> of the factors with a 2, <ellipsis />, and <m>i_n</m> of the factors with an <m>n</m>. The number of ways to do this is a multinomial coefficient, as we now explain. This labeling gives us a function from <m>[k]</m> to <m>[n]</m> as follows. If factor <m>i</m> is labelled <m>j</m> we let <m>f(i) =j</m>. Further each function <m>f</m> from <m>[k]</m> to <m>[n]</m> gives us that maps <m>i_j</m> elements of <m>[k]</m> to <m>j</m> will give us such a labelling. Thus the coefficient of <m>x_1^{i_1}x_2^{i_2}\cdots x_n^{i_n}</m> will be the multinomial coefficient <m>\binom{k}{i_1,i_2,\ldots, i_n}</m>.
        </p>
      </solution>
    </activity>
  </paragraphs>
  </subsection>




  <subsection xml:id="subsec-stirlingidentities">
    <title>Identities with Stirling Numbers</title>


    <p>
      The entries in the Pascal Triangle, <m>\binom{n}{k}</m>, satisfy the nice recursion <m>\binom{n}{k} = \binom{n - 1}{k} + \binom{n - 1}{k - 1}</m> and also have a closed formula: <m>\binom{n}{k} = \frac{n!}{k!(n - k)!}</m>.
      <xref ref="secondstirlingrecurrence"/> gives us a
      recursion for the Stirling numbers <m>S(k,n)</m> and, unfortunately, the best we can do for a <q>closed</q> formula is the following.<fn>This is not really a closed formula since the number of terms in the summation is not fixed.</fn>
    </p>

    <theorem xml:id="thm-stirling-closed">
      <statement>
        <p>
          <me>S(k,n) = \frac{1}{n!}\left[n^{k} - \binom{n}{1} \left( n - 1 \right)^{k} + \binom{n}{2} \left( n - 2 \right)^{k} - \ldots + \left( - 1 \right)^{n - 1}\binom{n}{n - 1} 1^{k} \right] </me>
        </p>
      </statement>
    </theorem>

    <p>
      We will prove this following an approach due to Polya.  The idea is to compare Stirling numbers to surjections, which we know how to count using the principle of inclusion and exclusion (see <xref ref="subsec_apps-of-pie"/>).
    </p>
    
    <activity xml:id="act_stirlingpie">
      <introduction>
        <p>
          Suppose you wished to paint <m>k</m> houses and you have <m>n</m> different colors available.  Each house will get a single color, but you want to ensure that each color is used at least once.
        </p>
      </introduction>
      
      <task>
        <statement>
          <p>
            Use the principle of inclusion and exclusion to write a formula for the number of ways to paint the houses.
          </p>
        </statement>
        <hint>
          <p>
            In what way is this problem like counting functions?
          </p>
        </hint>
      </task>
      <task>
        <statement>
          <p>
            What about the paint colors and the houses does <m>S(k,n)</m> count?  Why does this NOT answer the question?  By what factor are we off?
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Conclude that a formula for the Stirling numbers is 
            <me>
              S(k,n) = \frac{1}{n!}\sum_{s=0}^n (-1)^s\binom{n}{s}(n-s)^k.
            </me>.
          </p>
        </statement>
      </task>
    </activity>



    <!-- <exploration>
      <statement>
        <p>
          Prove <xref ref="thm-stirling-closed"/>
        </p>
      </statement>
      <hint>
        <p>
          First multiply both sides by <m>n!</m> and then prove that identity.  You might have already done so in <xref ref="act_stirlingpie"/>
        </p>
      </hint>
      <solution>
        <proof>
          <p>
            The following argument is due to Polya.
            Suppose you wished to paint n houses and you have <m>k</m> different colors available.
            The first house can be painted in <m>k</m> different ways, the second in <m>k</m> different ways, etc.
            So there are <m>k^{n}</m> ways.
            How many ways actually use all <m>k</m> colors?
            Let <m>\alpha_{i}</m> be the property that no house is painted with the <m>i</m>th color, and let <m>N(\alpha_{i})</m> denote the number of ways of painting the <m>n</m> houses without using the <m>i</m>th color.
            Analogously for <m>N(\alpha_{i},\alpha_{j})</m>, <m>N(\alpha_{i},\alpha_{j},\alpha_{k})</m>, etc.
            Since <m>N(\alpha_{i}) = (k - 1)^{n}</m>, <m>N(a_{i},\alpha_{j}) = ( k - 2)^{n}</m> and so on, the number of ways of painting <m>n</m> houses using all <m>k</m> colors is, using PIE,
            <m>k^{n} -\binom{k}{1} \left(k - 1 \right)^{n} + \binom{k}{2} \left( k - 2 \right)^{n} - \binom{k}{3}      \left( k - 3 \right)^{n} + \ldots + \left( - 1 \right)^{k}\binom{k}{k} 0^{n}</m>.
          </p>
          <p>
            Alternately, we could first partition the <m>n</m> houses into <m>k</m> (non-empty) sets, and then paint each set. This can be    accomplished in <m>k!S(n,k)</m> ways. Now equate these two expressions.
          </p>
        </proof>
      </solution>
    </exploration> -->

    <activity>
      <statement>
        <p>
          What does <xref ref="thm-stirling-closed"/> tell us about <m>S(k, 2)</m> (which we already know)?  What do we get for <m>S(k,3)</m>?
        </p>
      </statement>
      <solution>
        <p>
          <m>S(k,2) = 2^{k-1} - 1</m>.
        </p>
        <p>
          <m>S(k,3) = \frac{1}{2}\left[3^{k - 1} - 2^{k} + 1 \right]</m>
        </p>
      </solution>
    </activity>


    <p>
      Here is another identity involving Stirling numbers.
    </p>

    <theorem xml:id="thm-stirling-polynomial">
      <statement>
        <p>
          <m>x^{k} = S\left(k,1 \right)x + S\left(k,2 \right)x\left( x - 1 \right) + S\left(k,3 \right)x\left( x - 1 \right)\left( x - 2 \right) + \cdots
          + S\left(k,k \right)x\left( x - 1 \right)\cdots(x -k + 1)</m>

        </p>
      </statement>

    </theorem>

    <exploration>
      <statement>
        <p>
          Prove <xref ref="thm-stirling-polynomial"/>
        </p>
      </statement>
      <hint>
        <p>
          You have already done this as well, although not with <m>x</m>.
        </p>
      </hint>
      <solution>
        <proof>
          <p>
            Again, based on the proof by Polya.
            We can paint <m>n</m> houses, with <m>x</m> colors available, in <m>x^{n}</m> ways. Using exactly one color, there are <m>S\left( n,1 \right)x</m> ways. Using exactly two colors there are <m>S\left( n,2 \right)x(x - 1)</m> ways. Continue in this manner.
          </p>
        </proof>
      </solution>
    </exploration>

    <p>
      It is in this form that James Stirling originally developed these numbers.
      <m>S(k,n)</m> is used to convert from powers to binomial  coefficients as shown in the following:
    </p>

    <theorem xml:id="thm-stirling-polynomial2">
      <statement>
        <p>
          <m>x^{k} = S\left(k,1 \right)\binom{x}{1}1! + S\left(k,2 \right) \binom{x}{2}2! + \ldots + S\left(k,k \right)\binom{x}{k} k!</m>
        </p>
      </statement>
    </theorem>

    <exploration>
      <statement>
        <p>
          Prove <xref ref="thm-stirling-polynomial2"/>
        </p>
      </statement>
    </exploration>
    
    <p>
      As an example of the previous two theorems, consider how to write <m>x^3</m>.
    </p>
    
    <p>
      Using <xref ref="thm-stirling-polynomial"/>, we can write
      <me>
        x^3 = S(3,1)x + S(3,2)x(x-1) + S(3,3)x(x-1)(x-2) = x + 3x(x-1) + x(x-1)(x-2)
      </me>.
      Recognizing that the factors that involve <m>x</m> look like a factorial, we can convert them into binomial coefficients, which is what <xref ref="thm-stirling-polynomial2"/> says:
      <me>
        x^3 = \binom{x}{1} + 3\binom{x}{2}2! + \binom{x}{3}3! = \binom{x}{1} + 6\binom{x}{2} + 6 \binom{x}{3}.
      </me>
    </p>
    
    <p>
      Less we think this is nothing more than an interesting factoid, we can use it to establish the following.
    </p>
    
    <example>
      <statement>
        <p>
          Prove that <m>1^3 + 2^3 + 3^3 + \cdots + n^3 = \left(\frac{n(n+1)}{2}\right)^2</m>.  In other words, the square of any triangular number is the sum of cubes!
        </p>
      </statement>
      <solution>
        <p>
          We recognize that each cube on the left-hand side can be expressed as <m>\binom{x}{1} + 6 \binom{x}{2} + 6\binom{x}{3}</m>.  Thus
          <md>
            <mrow>1^3 + 2^3 + \cdots + n^3 = \amp \sum_{x=1}^n \left(\binom{x}{1} + 6 \binom{x}{2} + 6\binom{x}{3}\right)</mrow>
            <mrow> = \amp \sum_{x=1}^n \binom{x}{1} + 6 \sum_{x=1}^n \binom{x}{2} + 6 \sum_{x=1}^n \binom{x}{3}</mrow>
          </md>.
          Now each of the three sums of binomial coefficients can be simplified using the Hockey Stick Theorem, to get
          <md>
            <mrow> =  \amp \binom{n+1}{2} + 6 \binom{n+1}{3} + 6 \binom{n+1}{4} </mrow>
            <mrow> = \amp \binom{n+1}{2} + 6\left(\binom{n+1}{3}+\binom{n+1}{4}\right) </mrow>
            <mrow> = \amp \binom{n+1}{2} + 6\binom{n+2}{4} </mrow>
          </md>
          where the last step uses the Pascal triangle recurrence.
        </p>
        <p>
          Finally, write these last two binomial coefficients using the factorial formula and simplify:
          <me>
            \frac{n(n+1)}{2} + \frac{(n+2)(n+1)n(n-1)}{4} = \left(\frac{n(n+1)}{2}\right)^2
          </me>.
          
        </p>
      </solution>
    </example>
    
    <p>
      The remainder of this section contains some additional activities related to the identities above and Stirling numbers in general.
    </p>



    <exploration>
      <statement>
        <p>
          List the sequence of elements that are row sums of the Stirling Triangle.
        </p>
      </statement>
    </exploration>


    <exploration>
      <statement>
        <p>
          How many subsets <m>\{a,b,c\}</m> are there of <m>\{2,3,4,\ldots\}</m> such that <m>abc = 2 \cdot 3 \cdot 5 \cdot 7 \cdot 11 \cdot 13 \cdot 17</m>?
        </p>
      </statement>
    </exploration>

    <exploration>
      <statement>
        <p>
          Let <m>S = \{2,3,4,\ldots\}</m>.  How many ordered triples <m>(a,b,c)</m> are there in <m>S\times S \times S</m> such that <m>abc = 2 \cdot 3 \cdot 5 \cdot 7 \cdot 11 \cdot 13 \cdot 17</m>?
        </p>
      </statement>
    </exploration>

    


<!-- 11 -->
    <exploration>
      <introduction>
        <p>
          Determine the following:
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            <m>a, b, c</m> so that <m>n^4 = 24\binom{n}{4} + 6a\binom{n}{3}+2b\binom{n}{2} + c \binom{n}{1}</m>.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            <m>a, b, c, d</m> so that <m>n^5 = 5!\binom{n}{5} + a\binom{n}{4} + b\binom{n}{3} + c \binom{n}{2} + d \binom{n}{1}</m>.
          </p>
        </statement>
      </task>
    </exploration>


    <exploration>
      <statement>
        <p>
          Express <m>1^4 + 2^4 + 3^4 + \cdots + n^4</m> as a polynomial in <m>n</m>.
        </p>
      </statement>
    </exploration>


    <exploration>
      <statement>
        <p>
          Why is <m>4^k - 4\cdot 3^k + 6\cdot 2^k - 4</m> always divisible by 24?
        </p>
      </statement>
    </exploration>

</subsection>

<subsection xml:id="subsec_bell">
  <title>Bell Numbers</title>

    <p>
      The Bell number, <m>B_{k}</m>, denotes the number of ways that a set of <m>k</m> objects can be partitioned into nonempty subsets.
      We have already seen how to partition a set of <m>k</m> objects into exactly <m>n</m> subsets: <m>S(k,n)</m>.  So then <m>B_k = \sum_{n=1}^kS(k,n)</m>.  We take <m>B_0 = 1</m>.
    </p>

    <p>
      The sequence of Bell numbers starts
      <me>
        1, 1, 2, 5, 15, 52, 203, 877, 4140, 21147, 115975, \ldots
      </me>
      Notice that the first four numbers look like Catalan numbers.  In fact, one of the many things the Catalan numbers count are <em>non-crossing</em> set partitions.<fn>A set partition is said to be <term>non-crossing</term> as long as whenever <m>a,b</m> belong to one block and <m>c,d</m> belong to another, we have that <m>a</m> and <m>b</m> are both either larger or smaller than both of <m>c</m> and <m>d</m>.</fn>  So if <m>C_n</m> counts only some of the set partitions, then it must be that <m>C_n \le B_n</m> for all <m>n</m>.
    </p>


    <p>
      The Bell numbers can be generated by constructing what is called the Bell Triangle. To construct this triangle, begin with a 1 at the top and a 1 below it. Add these two numbers together and put the sum 2, to the right of the 1 in the second column. This 2 is also the first entry of the third row. The second entry in the third row is found by adding the 2 to the number 1 above it. This sum is 3 and goes to the right of the 2. The 3 is now below a 2. Adding these two numbers produces the last number, 5, in the third row. Since 5 has no number above it, the third row is complete. 5 now becomes the first number in the fourth row and the process continues.
    </p>

    <sidebyside width="70%">
      <tabular>
      <row><cell>1</cell> <cell> </cell> <cell> </cell> <cell> </cell> <cell></cell><cell/><cell/> </row>
      <row><cell>1 </cell><cell> 2 </cell><cell> </cell><cell> </cell><cell> </cell><cell/><cell/> </row>
      <row><cell>2 </cell><cell> 3 </cell><cell> 5 </cell><cell> </cell><cell> </cell><cell/><cell/> </row>
      <row><cell>5 </cell><cell> 7 </cell><cell> 10 </cell><cell> 15 </cell><cell> </cell><cell/><cell/> </row>
      <row><cell>15 </cell><cell> 20 </cell><cell> 27 </cell><cell> 37 </cell><cell> 52</cell><cell/><cell/> </row>
      <row> <cell>52 </cell><cell>67</cell><cell> 87</cell><cell> 114</cell><cell> 151</cell><cell> 203</cell><cell/></row>

      <row><cell> 203 </cell><cell>255</cell><cell> 322</cell><cell> 409</cell><cell> 523</cell><cell> 674</cell><cell> 877</cell></row>
    </tabular>
    </sidebyside>


    <p>
      To summarize, construction of the triangle follows two basic rules:
      <ol>
        <li>
          <p>
            The last number of each row is the first number of the next row.
          </p>
        </li>
        <li>
          <p>
            All other numbers are found by adding the number to the left of the
            missing number to the number directly above this same number.
          </p>
        </li>
      </ol>

      When the triangle is extended, as above, the Bell Numbers are found down
      the first column as well as along the outside diagonal.
    </p>

    <exploration>
      <statement>
        <p>
          Why does this triangle construction give you the Bell numbers?  Explain in terms of set partitions.
        </p>
      </statement>
    </exploration>


    <p>
      As with Pascal's Triangle, the Bell triangle has several interesting
      properties.
    </p>

    <exploration>
      <statement>
        <p>
          If the sum of a row is added to the Bell number at the end of that row, the next Bell number is obtained. For example, the sum of the fourth row plus the Bell number at the end of the row: <m>15 + 20 + 27 + 37 + 52 + 52</m> is 203, the next Bell number.  Why does this happen?
        </p>
      </statement>
    </exploration>

    <exploration>
      <statement>
        <p>
          Another pattern you might notice: the numbers of the second diagonal <m>1, 3, 10, 37, 151, 674, \ldots</m> are the sums of the horizontal rows.  Prove this!
        </p>
      </statement>
    </exploration>

    <p>
      Rotating the triangle slightly creates a <em>difference</em> triangle analogous to Pascal's Triangle. The entries that are formed recursively by adding in Pascal's Triangle are now differences of the two numbers above them in the Bell triangle.
    </p>

    <sidebyside width="100%">
      <tabular>
        <row>
          <cell>1</cell><cell/><cell>2</cell><cell/><cell>5</cell><cell/><cell>15</cell><cell/><cell>52</cell><cell/><cell>203</cell><cell/><cell>877</cell><cell><m>\ldots</m></cell>
        </row>
        <row>
          <cell/><cell>1</cell><cell/><cell>3</cell><cell/><cell>10</cell><cell/><cell>37</cell><cell/><cell>151</cell><cell/><cell>674</cell><cell><m>\ldots</m></cell><cell/>
        </row>
        <row>
          <cell/><cell/>
          <cell>2</cell><cell/><cell>7</cell><cell/><cell>27</cell><cell/><cell>114</cell><cell/><cell>523</cell><cell><m>\ldots</m></cell><cell/><cell/>
        </row>
        <row>
          <cell/><cell/><cell/>
          <cell>5</cell>
          <cell/><cell>20</cell><cell/><cell>87</cell><cell/><cell>409</cell><cell><m>\ldots</m></cell><cell/><cell/><cell/>
        </row>
        <row>
          <cell/><cell/><cell/><cell/>
          <cell>15</cell>
          <cell/><cell>67</cell><cell/><cell>322</cell><cell><m>\ldots</m></cell><cell/><cell/><cell/><cell/>
        </row>
        <row>
          <cell/><cell/><cell/><cell/><cell/>
          <cell>52</cell>
          <cell/><cell>255</cell><cell><m>\ldots</m></cell><cell/><cell/><cell/><cell/><cell/>
        </row>
        <row>
          <cell/><cell/><cell/><cell/><cell/><cell/>
          <cell>203</cell>
          <cell><m>\ldots</m></cell><cell/><cell/><cell/><cell/><cell/><cell/>
        </row>
      </tabular>
    </sidebyside>

    <exploration>
      <statement>
        <p>
          Explain why the differences work as they do in the rotated triangle.
        </p>
      </statement>
    </exploration>

    <p>
      Finally, rewriting the Bell triangle recursively indicates a nice
      connection of the Bell Numbers to Pascal's triangle.
    </p>

    <sidebyside width="100%">
      <tabular>
        <row>
          <cell>
            <m>B_{0} = B_{1}</m>
          </cell>
          <cell/><cell/><cell/>
        </row>
        <row>
          <cell>
            <m>B_{1}</m>
          </cell>
          <cell>
            <m>B_{0} + B_{1} = B_{2}</m>
          </cell>
          <cell/><cell/>
        </row>
        <row>
          <cell>
            <m>B_{2}</m>
          </cell>
          <cell>
            <m>B_{1} + B_{2}</m>
          </cell>
          <cell>
            <m>B_{0} + 2B_{1} + B_{2} = B_{3}</m>
          </cell>
          <cell/>
        </row>
        <row>
          <cell>
            <m>B_{3}</m>
          </cell>
          <cell>
            <m>B_{2} + B_{3}</m>
          </cell>
          <cell>
            <m>B_{1} + B_{2} + B_{2} + B_{3}</m>
          </cell>
          <cell>
            <m>B_{0} + 3B_{1} + 3B_{2} + B_{3} = B_{4}</m>
          </cell>
        </row>
      </tabular>
    </sidebyside>

    <p>
      This pattern suggests the <m>{(n + 1)}^{\text{th}}</m> Bell Number can be represented recursively by <m>B_{n + 1} = \binom{n}{0} B_{0} + \binom{n}{1} B_{1} + \binom{n}{2}B_{2} + \ldots + \binom{n}{n} B_{n}</m>. The coefficients of this equation are the entries of the <m>n</m>th row of Pascal's triangle.
    </p>

    <exploration xml:id="act_bellrecurrence">
      <statement>
        <p>
          Prove the recurrence <me>B_{k + 1} = \binom{k}{0} B_{0} + \binom{k}{1} B_{1} + \binom{k}{2}B_{2} + \ldots + \binom{k}{k} B_{k}</me>
        </p>
      </statement>
    </exploration>


    <p>
      The Bell numbers are related to the Stirling numbers and can be defined
      as the sum of the Stirling numbers of the second kind.
      That is, <m>B_{k} = S(k,1) + S(k,2) + \cdots + S(k,k)</m>, where <m>S(k,n)</m> represents the number of ways of grouping <m>k</m> elements into <m>n</m> subsets.
      So <m>B_{3} = S(3,1) + S(3,2) + S(3,3) = 1 + 3 + 1 = 5</m>.
      Since the Bell numbers count the partitions of a set of elements, they are used in prime-number theory to enumerate the number of ways to factor a number with distinct prime factors.
      For example, 42 has three distinct prime factors: 2, 3, and 7.
      Since <m>B_{3} = 5</m> , we know there are five ways of factoring 42.
      These are <m>2 \times 3 \times 7</m>, <m>2 \times 21</m>, <m>3 \times 14</m>, <m>6 \times 7</m>, and <m>42</m>.
      So the number <m>210</m>, which has 4 distinct factors, 2, 3, 5, and 7, can be factored in <m>B_{4} = 15</m> ways.
    </p>



    <p>
      The Bell numbers can be used to model many real-life situations. For
      example, the number of different ways two people can sleep in unlabeled
      twin beds is <m>B_{2} = 2</m> ways: They can sleep in the same bed or in
      separate beds. The number of ways of serving a dinner consisting of
      three items, such as a salad, bread, and fish is <m>B_{3} = 5</m> ways:
      each could be served on a separate plate, salad and bread could be on
      one plate and fish on another, salad and fish on one plate and bread on
      another, or all three items could be on the same plate. This example
      serves as a model for the five ways three people can occupy three
      unlabeled beds, the five ways three prisoners can be handcuffed
      together, the five ways three nations can be form alliances, or any
      situation of partitioning three distinct elements into non-empty
      subsets.
    </p>

    <p>
      One interesting application of Bell numbers is in counting the number of
      rhyme schemes possible for a stanza in poetry. There are <m>B_{2} = 2</m> possibilities for a two-line stanza: the lines can either rhyme or not
      rhyme. The possible rhyme schemes of a three-line stanza can be
      described as aaa, aab, aba, abb, and abc: thus there are 5 or <m>B_{3}</m> possible rhyme schemes. The Japanese used diagrams depicting possible
      rhyme schemes of a five-line stanza <m>B_{5} = 52</m> as early as 1000
      A.D. in the <em>Tale of the Genji</em> by Lady Shikibu Murasaki.
    </p>

    <exploration>
      <statement>
        <p>
          List all 15 rhyme schemes for a four-line stanza.  Identify the <m>C_4 = 14</m> such schemes that are <q>planar</q> (and say what this means).
        </p>
      </statement>
    </exploration>
    
    <exploration>
      <statement>
        <p>
          List all 15 set partitions of <m>[4]</m>.  Identify the <m>C_4 = 14</m> such partitions that are <q>non-crossing</q> (and say what this means).
        </p>
      </statement>
    </exploration>
    

    <p>
      We conclude with an interesting exercise.
    </p>
    <exploration>
      <statement>
        <p>
          The set <m>\{u_{0}, u_{1}, u_{2}, \ldots \}</m> where <m>u_{0} = 1</m>, <m>u_{1} = x</m>, <m>u_{2} = x(x - 1)</m>, <m>u_{3} = x(x - 1)(x - 2)</m>, etc., is a basis for the vector space <m>V</m> of all polynomials with real coefficients.
          Let <m>P(x) = c_{0}u_{0} + c_{1}u_{1} + c_{2}u_{2} + \cdots</m> be any element of <m>V</m>, and define the functional <m>L</m> as follows: <m>L\lbrack P(x)\rbrack = c_{0} + c_{1} + \cdots</m>.
        </p>
        <p>
          <ol>
            <li>
              <p>
                Prove that <m>L\left\lbrack P\left( x \right) + Q\left( x \right) \right\rbrack = L\left\lbrack P\left( x \right) \right\rbrack + L\left\lbrack Q\left( x \right) \right\rbrack.</m>
              </p>
            </li>
            <li>
              <p>
                Prove that <m>L\left\lbrack rP \left( x \right) \right\rbrack = rL\lbrack P\left( x \right)\rbrack</m> for <m>r \in \R</m> (the Reals).
              </p>
            </li>
            <li>
              <p>
                Prove that <m>B_{n} = L\lbrack x^{n}\rbrack</m> .
              </p>
            </li>
            <li>
              <p>
                Prove that <m>L\left\lbrack x^{n + 1} \right\rbrack = L\lbrack\left( x + 1 \right)^{n}\rbrack</m> .
              </p>
            </li>
            <li>
              <p>
                Derive the recursion in <xref ref="act_bellrecurrence"/> using the previous part.
              </p>
            </li>
          </ol>
        </p>
      </statement>
    </exploration>

  
</subsection>

</section>
